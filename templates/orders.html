<!DOCTYPE html>
<head>
    <!-- Mobile Specific Meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Favicon-->
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/fav.png') }}">
    <!-- Author Meta -->

    <!-- meta character set -->
    <meta charset="UTF-8">
    <!-- Site Title -->
    <title> Apollo Coffee</title>

    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,400,300,500,600,700" rel="stylesheet"> 
        <!--
        CSS
        ============================================= -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
        <style>
            :root {
                --header-bg-url: url("{{ url_for('static', filename='img/header-bg.jpg') }}");
            }
        </style>
    </head>
    <body>

          <header id="header" id="home">		  	
            <div class="container">
                <div class="row align-items-center justify-content-between d-flex">
                  <div id="logo">
                    <a href="{{ url_for('userindex') }}"><img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" title="" /></a>
                  </div>
                  <nav id="nav-menu-container">
                    <ul class="nav-menu">
                      <li class="menu-active"><a href="{{ url_for('userindex') }}">Home</a></li>
                      <li><a href="{{url_for('give_order')}}">Give Orders</a></li>
                      <li><a href="{{url_for('confirm_order')}}">Orders</a></li>
                      <li><a href="{{ url_for('logout') }}">Logout</a></li>
                    </ul>
                  </nav><!-- #nav-menu-container -->		    		
                </div>
            </div>
          </header><!-- #header --> 		
                </div>
            </div>
          </header><!-- #header -->


          <section class="banner-area" id="home">    
    
            <div class="container">
                <div class="row fullscreen d-flex align-items-center justify-content-start">
                    <div class="banner-content col-lg-7">
                        <div class="row">
                            <div class="col-lg-12">
                                <h2 class="text-2xl mb-3">Orders</h2>
                                {% if 'user_id' in session %}
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Product ID</th>
                                            <th>Quantity</th>
                                            <th>Delivery Time</th>
                                            <th>Order Date:</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for order in order_list %}
                                            <tr>
                                                <td>{{ order.coffee_type }}</td>
                                                <td>{{ order.quantity }}</td>
                                                <td>{{ order.delivery_time }}</td>
                                                <td>{{ order.date_time }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
        
                                <button onclick="location.href='/confirm_orders'" class="btn-confirm-orders">Confirm All Orders</button>
        
                                {% endif %}
                            </div>
                        </div>
                    </div>                                          
                </div>
            </div>
        </section>
        <!-- Confirmation Modal -->
        <div id="confirmationModal" class="modal">
            <div class="modal-content">
              <span class="close">&times;</span>
              <p>Are you sure you want to confirm all orders?</p>
              <button id="confirmBtn">Confirm</button>
              <button id="cancelBtn">Cancel</button>
            </div>
          </div>
        <!-- Thank You Section -->
        <div id="thankYouSection" style="display: none;">
            <h3>Thank you for your order, we are preparing your orders.</h3>
            <table id="orderSummaryTable" class="table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Product ID</th>
                        <th>Quantity</th>
                        <th>Delivery Time</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Order details will be dynamically inserted here -->
                </tbody>
            </table>
        </div>

                  


        <script src="{{ url_for('static', filename='js/jquery-2.2.4.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/main.js') }}"></script>
        <script>
            // Get the modal
            var modal = document.getElementById("confirmationModal");
          
            // Get the button that opens the modal
            var btn = document.querySelector(".btn-confirm-orders");
          
            // Get the <span> element that closes the modal
            var span = document.getElementsByClassName("close")[0];
          
            // When the user clicks the button, open the modal 
            btn.onclick = function() {
              modal.style.display = "block";
            }
          
            // When the user clicks on <span> (x), close the modal
            span.onclick = function() {
              modal.style.display = "none";
            }
          
            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
              if (event.target == modal) {
                modal.style.display = "none";
              }
            }
          
            // Handle confirm and cancel actions
            document.getElementById("confirmBtn").onclick = function() {
        var orderList = JSON.parse('{{ order_list | tojson | safe }}');

        // AJAX call to Flask backend
        $.ajax({
            type: 'POST',
            url: '/confirm_orders', // Flask route
            contentType: 'application/json;charset=UTF-8',
            data: JSON.stringify({orders: orderList}),
            success: function(response) {
                // Clear the table or remove the orders from the list
                var tableBody = document.querySelector('table tbody');
                tableBody.innerHTML = ''; // This clears the table

                // Optionally, display a message or redirect
                console.log("Orders confirmed:", response);
                alert("Orders have been confirmed."); // Example: Show a confirmation alert
                // Or redirect to another page
                // window.location.href = '/some_other_page';
            },
            error: function(error) {
                // Handle errors
                console.error("Error confirming orders:", error);
            }
        });

        modal.style.display = "none";
    };
            
          
            document.getElementById("cancelBtn").onclick = function() {
              modal.style.display = "none";
            };
          </script>
          
    </body>
</html>



